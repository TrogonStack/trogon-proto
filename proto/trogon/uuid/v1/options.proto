syntax = "proto3";
package trogon.uuid.v1;

import "elixirpb.proto";
import "google/protobuf/descriptor.proto";
import "trogon/uuid/v1/namespace.proto";

option (elixirpb.file).module_prefix = "TrogonProto.Uuid.V1";

// FileOptions defines file-level options for UUID generation.
message FileOptions {
  // The default namespace for UUIDv5 generation.
  // Used as fallback when enum-level or value-level namespace is not specified.
  optional Namespace namespace = 1;
}

// EnumOptions defines enum-level options for UUID generation.
message EnumOptions {
  // The namespace for UUIDv5 generation.
  // Takes precedence over file-level namespace.
  optional Namespace namespace = 1;
}

// EnumValueOptions defines enum-value-level options for UUID generation.
message EnumValueOptions {
  // Format defines the UUID generation parameters.
  // Nested to avoid conflicts with potential top-level Format messages.
  message Format {
    // The namespace for UUIDv5 generation.
    // If not set, falls back to enum-level or file-level namespace option.
    optional Namespace namespace = 1;

    // The template string for generating the UUID input value.
    // Supports placeholders that map to field names in your request message.
    // Example: "warehouse/{warehouse_id}/sku/{sku_code}"
    string template = 2;
  }

  // The UUID generation format for this identity version.
  optional Format format = 1;
}

extend google.protobuf.FileOptions {
  // file defines the file-level UUID generation options.
  //
  // Example:
  //   option (trogon.uuid.v1.file).namespace = { uuid: "550e8400-e29b-41d4-a716-446655440000" };
  //   option (trogon.uuid.v1.file).namespace = { dns: "acme.com" };
  //
  optional FileOptions file = 870000;
}

extend google.protobuf.EnumOptions {
  // enum defines the enum-level UUID generation options.
  // Takes precedence over file-level options.
  //
  // Example:
  //   enum SkuIdentityVersion {
  //     option (trogon.uuid.v1.enum).namespace = { uuid: "550e8400-e29b-41d4-a716-446655440000" };
  //     SKU_IDENTITY_VERSION_UNSPECIFIED = 0;
  //   }
  //
  optional EnumOptions enum = 870001;
}

extend google.protobuf.EnumValueOptions {
  // enum_value specifies the UUID generation options for an identity version.
  //
  // Resolution order for namespace:
  //   1. enum_value.format.namespace (if set on the enum value)
  //   2. enum.namespace (if set on the enum)
  //   3. file.namespace (file-level fallback)
  //   4. Error if none are set
  //
  // Example usage:
  //
  //   // acme/inventory/v1/sku.proto
  //   syntax = "proto3";
  //   package acme.inventory.v1;
  //
  //   import "trogon/uuid/v1/options.proto";
  //
  //   // File-level default
  //   option (trogon.uuid.v1.file).namespace = { uuid: "550e8400-e29b-41d4-a716-446655440000" };
  //
  //   enum SkuIdentityVersion {
  //     SKU_IDENTITY_VERSION_UNSPECIFIED = 0;
  //
  //     // V1: Uses file-level namespace
  //     SKU_IDENTITY_VERSION_V1 = 1 [(trogon.uuid.v1.enum_value).format = {
  //       template: "warehouse/{warehouse_id}/sku/{sku_code}"
  //     }];
  //
  //     // V2: Uses DNS namespace
  //     SKU_IDENTITY_VERSION_V2 = 2 [(trogon.uuid.v1.enum_value).format = {
  //       namespace: { dns: "inventory.acme.com" },
  //       template: "sku/{sku_code}"
  //     }];
  //
  //     // V3: Uses URL namespace
  //     SKU_IDENTITY_VERSION_V3 = 3 [(trogon.uuid.v1.enum_value).format = {
  //       namespace: { url: "https://acme.com/inventory/sku" },
  //       template: "{sku_code}"
  //     }];
  //
  //     // V4: Explicit UUID override
  //     SKU_IDENTITY_VERSION_V4 = 4 [(trogon.uuid.v1.enum_value).format = {
  //       namespace: { uuid: "7c9e6679-7425-40de-944b-e07fc1f90ae7" },
  //       template: "region/{region}/sku/{sku_code}"
  //     }];
  //   }
  //
  optional EnumValueOptions enum_value = 870002;
}
